<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title></title>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>    
</head>
<body>

<script src="http://vk.com/js/api/openapi.js" type="text/javascript"></script>
<div id="login_button" onclick="VK.Auth.login(authInfo);"></div>
<span id="VKInfo"> </span>
<script language="javascript">
    VK.init({
        apiId: 5187107
    });
    function authInfo(response) {    
    if(response.status=='connected') {	// если пользователь залогинен в ВК     
        if(typeof(response.session.user) == 'undefined') { // этого поля нет 
                //тогда, когда пользователь был залогинен ранее
                VK.Api.call('users.get', { uid: response.session.mid }, function(r) { 
                    $('#VKInfo').html(r.response[0].first_name+' '+r.response[0].last_name); 
                    $('#VKInfo').append('user_id: '+response.session.mid); });
   }else {
        // если авторизация прошла только что (от VK.Auth.login(authInfo);), то имя и фамилия уже будут в ответе   
        $('#VKInfo').html(response.session.user.first_name+' '+response.session.user.last_name);
        $('#VKInfo').append('
user_id: '+response.session.mid);}
   
       }else {
        VK.Auth.login(authInfo); // опционально можем спалиться и вызвать всплывающее окно авторизации
    }
}
 
$(function() { VK.Auth.getLoginStatus(authInfo); });
    /*function authInfo(response) {
        if (response.session) {
            alert('user: '+response.session.mid);
        } else {
            alert('not auth');
        }
    }
    //VK.Auth.getLoginStatus(authInfo);
    VK.UI.button('login_button');
    VK.Api.call('friends.get', { fields : 'first_name, last_name'}, function(data){
       // if (data.response) {
           // for (var i = 0; i < data.response.count; i++) {
                $("#friends_info").html(data.response[0].first_name + data.response[0].last_name)
           // }
        //}
        //else {alert("Error");}
    });*/
</script>
</body>
</html>
